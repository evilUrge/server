{% import 'macros/library.html' as library %}

{% macro topic_header(id, title, description, count, even) %}
    <a class='heading ui-accordion-header ui-helper-reset ui-state-default ui-corner-all{% if even %} even{% endif %}'
        id="_{{ id }}" href="#{{ id }}">
        <span class="ui-icon ui-icon-triangle-1-w"></span>
        <div>
            <div class="topic-title">{{ title }}</div>
            {% if description %}<div class='topic-desc'>{{ description }}</div>{% endif %}
            {% if count.exercise %}<div class="topic-counts exercises">{{ count.exercise }}</div>{% endif %}
            {% if count.video %}<div class="topic-counts videos">{{ count.video }}</div>{% endif %}
        </div>
    </a>
{% endmacro %}

<div id="library">
    <div id="library-content" >
        {{ library.column_major_order_styles() }}
        <div id="library-content-main">
            <a name="browse"></a>
            <ul class="accordion ui-accordion ui-widget ui-helper-reset ui-accordion-icons">
                {% for topic in topics recursive %}
                    <li class="topic-level-{{ topic.depth }} ">
                        {{ topic_header(topic.id, topic.title, topic.description, topic.all_content_count, loop.index%2) }}
                        <div class="content" style="display: none">
                            {% if topic.subtopics %}
                                <ul>
                                    {{ loop(topic.subtopics) }}
                                    {% if topic.content %}
                                        {# topic has both subtopics and content; put content in a 'fake' subtopic #}
                                        <li class="topic-level-{{ topic.depth+1 }}">
                                            {{ topic_header(topic.id + '-leaf', 'תוכן נוסף', None, topic.content_count, loop.index%2) }}
                                            <div class="content" style="display: none">
                                                {{ templatetags.column_major_sorted_videos(topic) }}
                                            </div>
                                        </li>
                                    {% endif %}
                                </ul>
                            {% elif topic.content %}
                                {{ templatetags.column_major_sorted_videos(topic) }}
                            {% endif %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
            <div class="clear"></div>
        </div>
    </div>
</div>

<!-- Topic tree version: #{{ version_id }}, published {{ version_date }} -->

{# Pass along the caching information to the JS so that
	when it makes its request for content, it can use this token #}
{% if ajax %}
    <script>var Homepage_cacheToken = {{ timestamp }};</script>
{% endif %}

